import express from "express";
const router = express.Router();
import { LandUser } from "../model/LandUser.js";

//Create a User
router.post("/addfromgoogle", async (req, res) => {
  console.log(req.body);

  try {
    // const {error} = validate(req.body);
    // if(error){
    //     console.log("Problem with credentials")
    //     console.log(req.body)
    //     console.log(error.details[0].message)
    //     return (res.status(400).send({message: error.details[0].message}))
    // }else{
    const user = await LandUser.findOne({ email: req.body.email });

    if (user) {
      res
        .status(201)
        .send({ message: "User already registered to the system" });
      console.log("User already registered to the system");
      // return res.status(409).send({message: "User with given email already exists"})
    } else {
      await new LandUser({
        firstName: req.body.givenName,
        lastName: req.body.familyName,
        email: req.body.email,
        password: "",
        gender: "",
        city: "",
        province: "",
        username: req.body.name,
        role: "user",
        token: "token",
      }).save();
      res
        .status(201)
        .send({ message: "Google user created on db Successfully" });
    }
    // }
  } catch (error) {
    res.status(500).send({ message: "Internal Server Error:",error });
  }
});

export default router;
